<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heladería - Menú de Productos</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Great Vibes', cursive;

        }

        html,
        body {
            overflow-x: hidden;
            width: 100%;
            max-width: 100vw;
            background: linear-gradient(135deg, #f8f4f0 0%, #f0e6d2 100%);
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #f8f4f0 0%, #f0e6d2 100%);
            color: #2c3e50;
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.1);

            background: linear-gradient(135deg, #f8f4f0 0%, #f0e6d2 100%);
        }

        /* Header mejorado con imagen */
        .header {
            background: linear-gradient(#d9f1cf, #b2cfa6, #97cd80),
                url('./cande\ logo.png') center/cover;
            padding: 40px 25px;
            text-align: center;
            position: relative;
            overflow: hidden;
            min-height: 300px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            min-height: 100vh;
            background-color: #fdfaf4;
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23e0cda9' fill-opacity='0.3'%3E%3Ccircle cx='10' cy='10' r='5'/%3E%3Ccircle cx='30' cy='30' r='5'/%3E%3Ccircle cx='50' cy='50' r='5'/%3E%3C/g%3E%3C/svg%3E");
            background-repeat: repeat;
            background-size: auto;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.1);
        }



        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: repeating-linear-gradient(45deg,
                    transparent,
                    transparent 10px,
                    rgba(255, 255, 255, 0.05) 10px,
                    rgba(255, 255, 255, 0.05) 20px);
            pointer-events: none;
        }

        .header h1 {
            font-size: 3.5rem;
            color: white;
            font-weight: 700;
            margin-bottom: 15px;
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.5);
            position: relative;
            z-index: 2;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .header-logo {
            width: 200px;
            height: 200px;
            object-fit: contain;
            filter: drop-shadow(3px 3px 6px rgba(0, 0, 0, 0.5));
            transition: transform 0.3s ease;
        }

        .header-logo:hover {
            transform: scale(1.1) rotate(5deg);
        }

        .header-title {
            text-align: center;
        }

        .header .subtitle {
            color: rgba(255, 255, 255, 0.95);
            font-size: 1.4rem;
            font-style: italic;
            position: relative;
            z-index: 2;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.4);
            font-weight: 500;
        }

        /* Navegación siempre visible */
        .nav-tabs {
            background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%);
            border-bottom: 3px solid #c19653;
            padding: 0;
            margin: 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.2);
        }

        .nav-tabs ul {
            list-style: none;
            display: flex;
            margin: 0;
            padding: 0;
            justify-content: center;
        }

        .nav-tabs li {
            margin: 0 2px;
        }

        .nav-tabs a {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 18px 30px;
            text-decoration: none;
            color: rgba(255, 255, 255, 0.8);
            background: transparent;
            border-radius: 8px 8px 0 0;
            font-size: 1.1rem;
            font-weight: 500;
            transition: all 0.3s ease;
            position: relative;
        }

        .nav-tabs a:hover {
            background: rgba(255, 255, 255, 0.15);
            color: white;
            transform: translateY(-3px);
        }

        .nav-tabs a.active {
            background: white;
            color: #c19653;
            font-weight: 600;
            box-shadow: 0 -5px 15px rgba(0, 0, 0, 0.15);
        }

        .nav-tabs a.active::after {
            content: '';
            position: absolute;
            bottom: -3px;
            left: 0;
            right: 0;
            height: 3px;
            background: #c19653;
        }

        .content {
            padding: 30px;
        }

        /* Panel de filtros avanzado */
        .filters-panel {
            background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);
            border: 2px solid #e9ecef;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
        }

        .filters-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e9ecef;
        }

        .filters-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.3rem;
            font-weight: 600;
            color: #2c3e50;
        }

        .filters-toggle {
            background: #c19653;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .filters-toggle:hover {
            background: #a67c00;
            transform: scale(1.05);
        }

        .filters-content-productos {
            display: grid;
            grid-template-columns: 1fr auto auto;
            gap: 20px;
            align-items: end;
        }

        .search-section {
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 12px 45px 12px 15px;
            border: 2px solid #dee2e6;
            border-radius: 25px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }

        .search-input:focus {
            outline: none;
            border-color: #c19653;
            box-shadow: 0 0 0 3px rgba(193, 150, 83, 0.1);
            transform: translateY(-2px);
        }

        .search-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #6c757d;
            font-size: 1.2rem;
            pointer-events: none;
        }

        .filter-dropdown {
            position: relative;
            min-width: 250px;
        }

        .dropdown-select {
            width: 100%;
            padding: 12px 40px 12px 15px;
            border: 2px solid #dee2e6;
            border-radius: 25px;
            background: white;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            appearance: none;
        }

        .dropdown-select:focus {
            outline: none;
            border-color: #c19653;
            box-shadow: 0 0 0 3px rgba(193, 150, 83, 0.1);
        }

        .dropdown-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #6c757d;
            pointer-events: none;
        }

        .filter-actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            white-space: nowrap;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .btn-primary {
            background: linear-gradient(135deg, #c19653, #a67c00);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c757d, #5a6268);
            color: white;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid #c19653;
            color: #c19653;
        }

        .btn-outline:hover {
            background: #c19653;
            color: white;
        }

        /* Estadísticas de filtros */
        .filter-stats {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 15px;
        }

        .stats-info {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 5px;
            color: #6c757d;
            font-size: 0.9rem;
        }

        .active-filters {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .filter-tag {
            background: #c19653;
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .filter-tag .remove {
            cursor: pointer;
            font-weight: bold;
            padding: 0 2px;
        }

        .filter-tag .remove:hover {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
        }

        /* Vista Productos mejorada */
        .productos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .producto-card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            overflow: hidden;
            transition: all 0.3s ease;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
            position: relative;
        }

        .producto-card:hover {
            border-color: #c19653;
            box-shadow: 0 10px 30px rgba(193, 150, 83, 0.2);
            transform: translateY(-5px);
        }

        .producto-card-imagen {
            width: 100%;
            height: 200px;
            position: relative;
            overflow: hidden;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
        }

        .producto-card-imagen img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .producto-card:hover .producto-card-imagen img {
            transform: scale(1.05);
        }

        .producto-card-placeholder {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #d4a574, #c19653);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            color: white;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .producto-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(193, 150, 83, 0.9);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            backdrop-filter: blur(10px);
        }

        .producto-card-body {
            padding: 20px;
        }

        .producto-card-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
            line-height: 1.3;
        }

        .producto-card-descripcion {
            color: #6c757d;
            font-size: 0.95rem;
            margin-bottom: 15px;
            line-height: 1.5;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .producto-card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 15px;
            border-top: 2px solid #f8f9fa;
        }

        .producto-card-precio {
            color: #28a745;
            font-weight: 700;
            font-size: 1.5rem;
        }

        .producto-card-categoria {
            background: #f8f9fa;
            color: #6c757d;
            padding: 6px 12px;
            font-size: 0.85rem;
            border-radius: 15px;
            border: 1px solid #e9ecef;
        }

        .loading {
            text-align: center;
            padding: 60px;
            color: #6c757d;
            font-style: italic;
            font-size: 1.2rem;
        }

        .loading i {
            font-size: 2rem;
            margin-bottom: 15px;
            display: block;
            animation: spin 2s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Animación para frases rotativas */
        @keyframes fadeInOut {

            0%,
            20%,
            100% {
                opacity: 0;
                transform: translateY(10px);
            }

            25%,
            75% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .subtitle-rotating {
            animation: fadeInOut 4s infinite;
        }

        .no-results {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border: 2px dashed #dee2e6;
            padding: 60px;
            text-align: center;
            color: #6c757d;
            margin: 30px 0;
            border-radius: 15px;
            grid-column: 1 / -1;
        }

        .no-results i {
            font-size: 3rem;
            margin-bottom: 15px;
            display: block;
            color: #c19653;
        }

        .error {
            background: linear-gradient(135deg, #f8d7da, #f5c6cb);
            border: 2px solid #f5c6cb;
            color: #721c24;
            padding: 20px;
            margin: 30px 0;
            border-radius: 15px;
            text-align: center;
        }

        /* Modal mejorado con mejor organización del contenido */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            max-width: 700px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(-50px);
            }

            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .modal-header {
            background: linear-gradient(135deg, #c19653, #a67c00);
            color: white;
            padding: 20px 25px;
            border-radius: 20px 20px 0 0;
            font-weight: 600;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 1.8rem;
            cursor: pointer;
            color: rgba(255, 255, 255, 0.8);
            padding: 5px;
            border-radius: 50%;
            transition: all 0.3s ease;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            color: white;
            background: rgba(255, 255, 255, 0.1);
            transform: scale(1.1);
        }

        .modal-body {
            padding: 0;
        }

        /* Contenedor principal del producto en el modal */
        .modal-producto-container {
            display: flex;
            flex-direction: column;
            gap: 0;
        }

        /* Sección de imagen - SÚPER GRANDE Y PROTAGONISTA + CLICKEABLE */
        .modal-imagen-section {
            width: 100%;
            padding: 15px;
            display: flex;
            justify-content: center;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            position: relative;
        }

        .modal-image {
            width: 100%;
            max-width: 100%;
            height: 400px;
            /* MÁS GRANDE */
            object-fit: contain;
            border-radius: 15px;
            border: 3px solid #ffffff;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.25);
            background: white;
            padding: 8px;
            cursor: pointer;
            /* Indica que es clickeable */
            transition: all 0.3s ease;
        }

        .modal-image:hover {
            transform: scale(1.02);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.35);
        }

        .modal-placeholder {
            width: 100%;
            max-width: 100%;
            height: 400px;
            /* MÁS GRANDE */
            background: linear-gradient(135deg, #d4a574, #c19653);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 8rem;
            /* EMOJI GIGANTE */
            color: white;
            text-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
            border-radius: 15px;
            border: 3px solid #ffffff;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.25);
        }

        /* Indicador de que la imagen es clickeable */
        .imagen-clickeable-overlay {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
            backdrop-filter: blur(10px);
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .modal-imagen-section:hover .imagen-clickeable-overlay {
            opacity: 1;
        }

        /* NUEVO: Modal de imagen en pantalla completa */
        .fullscreen-image-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            backdrop-filter: blur(10px);
            cursor: zoom-out;
        }

        .fullscreen-image-container {
            position: relative;
            max-width: 95vw;
            max-height: 95vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .fullscreen-image {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            border-radius: 10px;
            box-shadow: 0 0 50px rgba(255, 255, 255, 0.1);
        }

        .fullscreen-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .fullscreen-close:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .fullscreen-info {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 0.9rem;
            backdrop-filter: blur(10px);
            text-align: center;
        }

        /* Animación de entrada para pantalla completa */
        @keyframes fullscreenZoomIn {
            from {
                opacity: 0;
                transform: scale(0.3);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .fullscreen-image-container {
            animation: fullscreenZoomIn 0.3s ease-out;
        }

        /* Sección de información del producto */
        .modal-info-section {
            padding: 25px;
        }

        .modal-producto-titulo {
            color: #2c3e50;
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 20px;
            text-align: center;
            line-height: 1.3;
        }

        .modal-info-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .modal-info-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #c19653;
        }

        .modal-info-label {
            font-weight: 600;
            color: #6c757d;
            min-width: 80px;
        }

        .modal-info-value {
            flex: 1;
        }

        .modal-precio {
            color: #28a745;
            font-weight: 700;
            font-size: 1.5rem;
        }

        .modal-categoria-badge {
            background: linear-gradient(135deg, #e9ecef, #f8f9fa);
            padding: 6px 15px;
            border-radius: 20px;
            color: #6c757d;
            border: 2px solid #e9ecef;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .modal-descripcion {
            background: #fff;
            border: 2px solid #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-top: 15px;
        }

        .modal-descripcion-titulo {
            color: #6c757d;
            font-weight: 600;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .modal-descripcion-texto {
            line-height: 1.6;
            color: #000000;
            font-size: 1.5rem;
        }

        /* Sección de acciones */
        .modal-actions {
            padding: 20px 25px;
            border-top: 2px solid #f8f9fa;
            text-align: center;
            background: #fafbfc;
            border-radius: 0 0 20px 20px;
        }

        /* Responsive para móviles - IMÁGENES GIGANTES */
        @media (max-width: 768px) {
            .modal {
                padding: 5px;
            }

            .modal-content {
                max-width: calc(100vw - 10px);
                max-height: calc(100vh - 10px);
                border-radius: 15px;
            }

            .modal-header {
                padding: 10px 12px;
                font-size: 1rem;
                border-radius: 15px 15px 0 0;
            }

            .modal-close {
                top: 8px;
                right: 10px;
                font-size: 1.4rem;
            }

            .modal-imagen-section {
                padding: 12px;
                background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            }

            .modal-image,
            .modal-placeholder {
                max-width: 100%;
                height: 350px;
                /* IMAGEN GIGANTE EN MÓVIL */
                width: 100%;
            }

            .modal-placeholder {
                font-size: 7rem;
                /* EMOJI GIGANTE */
            }

            .modal-info-section {
                padding: 12px;
            }

            .modal-producto-titulo {
                font-size: 1.3rem;
                margin-bottom: 10px;
                text-align: center;
            }

            .modal-info-item {
                padding: 6px 8px;
                flex-direction: row;
                align-items: center;
                gap: 8px;
                font-size: 0.9rem;
            }

            .modal-info-label {
                min-width: 60px;
                font-size: 0.85rem;
            }

            .modal-precio {
                font-size: 1.1rem;
            }

            .modal-actions {
                padding: 10px 12px;
            }

            .modal-descripcion {
                padding: 10px;
                margin-top: 8px;
                font-size: 0.9rem;
            }
        }

        @media (max-width: 480px) {
            .modal-content {
                max-width: calc(100vw - 5px);
                border-radius: 12px;
                max-height: calc(100vh - 5px);
            }

            .modal-header {
                padding: 8px 10px;
                font-size: 0.95rem;
                border-radius: 12px 12px 0 0;
            }

            .modal-close {
                top: 6px;
                right: 8px;
                font-size: 1.3rem;
            }

            .modal-imagen-section {
                padding: 10px;
            }

            .modal-image,
            .modal-placeholder {
                height: 320px;
                /* IMAGEN ENORME incluso en pantallas pequeñas */
                width: 100%;
            }

            .modal-placeholder {
                font-size: 6.5rem;
                /* EMOJI ENORME */
            }

            .modal-info-section {
                padding: 10px;
            }

            .modal-producto-titulo {
                font-size: 1.2rem;
                margin-bottom: 8px;
                line-height: 1.2;
            }

            .modal-info-item {
                padding: 5px 6px;
                gap: 6px;
                font-size: 0.85rem;
            }

            .modal-info-label {
                min-width: 55px;
                font-size: 0.8rem;
            }

            .modal-precio {
                font-size: 1rem;
            }

            .modal-descripcion {
                padding: 8px;
                font-size: 0.85rem;
            }

            .modal-actions {
                padding: 8px 10px;
            }

            .btn {
                padding: 6px 12px;
                font-size: 0.85rem;
            }
        }

        /* Pantallas muy pequeñas - IMAGEN SIGUE SIENDO GIGANTE */
        @media (max-width: 360px) {
            .modal-imagen-section {
                padding: 8px;
            }

            .modal-image,
            .modal-placeholder {
                height: 280px;
                /* IMAGEN GIGANTE incluso aquí */
            }

            .modal-placeholder {
                font-size: 5.5rem;
                /* EMOJI GIGANTE */
            }

            .modal-info-section {
                padding: 8px;
            }

            .modal-producto-titulo {
                font-size: 1.1rem;
                line-height: 1.1;
                margin-bottom: 6px;
            }

            .modal-info-item {
                padding: 4px;
                font-size: 0.8rem;
            }

            .modal-descripcion {
                padding: 6px;
                font-size: 0.8rem;
            }
        }

        /* Contador de productos por categoría */
        .categoria-badge {
            background: rgba(40, 167, 69, 0.1);
            color: #28a745;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 8px;
        }

        /* .menu-carta {
        max-width: 900px;
        margin: 0 auto;
        background: #fff;
        padding: 20px 30px;
        border-radius: 15px;
        box-shadow: 0 5px 20px rgba(0,0,0,0.05);
    } */



        .categoria-buttons-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 10px;
        }

        .categoria-btn {
            background: #fff;
            border: 1.5px solid #c19653;
            border-radius: 10px;
            padding: 6px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.75rem;
            font-weight: 600;
            color: #c19653;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.04);
            min-height: 60px;
        }

        .categoria-btn:hover,
        .categoria-btn.active {
            background: #c19653;
            color: white;
            transform: scale(1.05);
        }

        .categoria-btn i,
        .categoria-btn span:first-child {
            font-size: 1.2rem;
            line-height: 1;
        }



        /* Responsive optimizado para móvil */
        @media (max-width: 1024px) {
            .filters-content-productos {
                display: flex;
                flex-direction: column;
                gap: 15px;
                width: 100%;
            }

            .filter-dropdown {
                min-width: auto;
                width: 100%;
            }

            .filter-actions {
                justify-content: center;
                width: 100%;
            }

            .productos-grid {
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                gap: 20px;
            }
        }

        @media (max-width: 768px) {
            * {
                box-sizing: border-box;
            }

            body {
                overflow-x: hidden;
                width: 100vw;
                max-width: 100%;
            }

            .container {
                margin: 0;
                box-shadow: none;
                width: 100vw;
                max-width: 100%;
                overflow-x: hidden;
            }

            .header {
                padding: 20px 10px;
                min-height: 250px;
                width: 100%;
            }

            .header h1 {
                font-size: 2.2rem;
                word-break: break-word;
                flex-direction: column;
                gap: 10px;
            }

            .header-logo {
                width: 100px;
                height: 100px;
            }

            .header .subtitle {
                font-size: 1.1rem;
            }

            .content {
                padding: 10px;
                width: 100%;
                max-width: 100%;
            }

            .nav-tabs {
                width: 100%;
                overflow-x: hidden;
            }

            .nav-tabs ul {
                display: flex;
                width: 100%;
                margin: 0;
                padding: 0;
            }

            .nav-tabs li {
                flex: 1;
                margin: 0;
            }

            .nav-tabs a {
                text-align: center;
                border-radius: 0;
                padding: 15px 8px;
                font-size: 0.9rem;
                white-space: nowrap;
            }

            .filters-panel {
                padding: 15px 10px;
                margin-bottom: 15px;
                width: 100%;
                max-width: 100%;
            }

            .filters-content-productos {
                display: flex;
                flex-direction: column;
                gap: 12px;
                width: 100%;
            }

            .search-section,
            .filter-dropdown {
                width: 100%;
                min-width: auto;
            }

            .search-input,
            .dropdown-select {
                width: 100%;
                max-width: 100%;
                box-sizing: border-box;
            }

            .filter-stats {
                flex-direction: column;
                align-items: stretch;
                gap: 10px;
                padding: 10px;
            }

            .stats-info {
                flex-wrap: wrap;
                justify-content: center;
                gap: 10px;
            }

            .active-filters {
                justify-content: center;
                flex-wrap: wrap;
            }

            .productos-grid {
                grid-template-columns: 1fr 1fr;
                gap: 15px;
                width: 100%;
            }

            .producto-card {
                width: 100%;
                max-width: 100%;
                box-sizing: border-box;
            }

            .modal {
                padding: 5px;
                width: 100vw;
                height: 100vh;
            }

            .modal-content {
                width: 100%;
                max-width: calc(100vw - 10px);
                max-height: calc(100vh - 10px);
                margin: 0;
            }

            .modal-image,
            .modal-placeholder {
                float: none;
                margin: 0 auto 15px;
                display: block;
                max-width: 100%;
                width: 100%;
                height: 200px;
            }

            .modal-body {
                padding: 15px;
            }
        }

        @media (max-width: 480px) {
            .header {
                padding: 15px 8px;
                min-height: 200px;
            }

            .header h1 {
                font-size: 1.8rem;
                line-height: 1.2;
                flex-direction: column;
                gap: 8px;
            }

            .header-logo {
                width: 150px;
                height: 100px;
            }

            .header .subtitle {
                font-size: 1rem;
            }

            .content {
                padding: 8px;
            }

            .nav-tabs a {
                padding: 12px 6px;
                font-size: 0.8rem;
            }

            .filters-panel {
                padding: 12px 8px;
                border-radius: 8px;
            }

            .filters-title {
                font-size: 1.1rem;
            }

            .search-input,
            .dropdown-select {
                padding: 10px 35px 10px 12px;
                font-size: 0.9rem;
            }

            .btn {
                padding: 10px 16px;
                font-size: 0.9rem;
            }

            .producto-card-imagen {
                height: 180px;
            }

            .producto-card-body {
                padding: 12px;
            }

            .producto-card-title {
                font-size: 1.1rem;
            }

            .producto-card-descripcion {
                font-size: 0.85rem;
            }

            .producto-card-precio {
                font-size: 1.3rem;
            }

            .modal-content {
                border-radius: 15px;
            }

            .modal-header {
                padding: 15px;
                font-size: 1.1rem;
            }

            .modal-body {
                padding: 12px;
            }
        }

        @media (max-width: 360px) {
            .header h1 {
                font-size: 1.6rem;
            }

            .nav-tabs a {
                padding: 10px 4px;
                font-size: 0.75rem;
            }

            .nav-tabs a i {
                display: none;
            }

            .content {
                padding: 6px;
            }

            .filters-panel {
                padding: 10px 6px;
            }

            .producto-card-body {
                padding: 10px;
            }

            .producto-card-imagen {
                height: 160px;
            }
        }




        .icono-categoria {
            width: 40px;
            height: 40px;
            object-fit: contain;
            display: block;
            margin-bottom: 4px;
        }




        /* Estilos para el header del menú con botones de acción */
        .menu-header-actions {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);
            border-radius: 15px;
            border: 2px solid #e9ecef;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
        }

        .menu-title-section {
            flex: 1;
        }

        .menu-actions {
            display: flex;
            gap: 12px;
            flex-shrink: 0;
        }

        .menu-action-btn {
            white-space: nowrap;
            min-width: 140px;
            justify-content: center;
        }

        .menu-action-btn .btn-text {
            margin-left: 5px;
        }

        /* Estilos para las opciones de compartir */
        .compartir-opciones {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 15px;
        }

        .compartir-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 16px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            color: white;
        }

        .compartir-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .compartir-btn.whatsapp {
            background: linear-gradient(135deg, #25D366, #1ebe57);
        }

        .compartir-btn.facebook {
            background: linear-gradient(135deg, #1877F2, #166fe5);
        }

        .compartir-btn.twitter {
            background: linear-gradient(135deg, #1DA1F2, #0d8bd9);
        }

        .compartir-btn.email {
            background: linear-gradient(135deg, #6c757d, #5a6268);
        }

        /* Notificaciones */
        .notificacion {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 10px;
            color: white;
            font-weight: 600;
            z-index: 3000;
            display: flex;
            align-items: center;
            gap: 10px;
            transform: translateX(400px);
            opacity: 0;
            transition: all 0.3s ease;
            max-width: 300px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .notificacion.show {
            transform: translateX(0);
            opacity: 1;
        }

        .notificacion.success {
            background: linear-gradient(135deg, #28a745, #1e7e34);
        }

        .notificacion.error {
            background: linear-gradient(135deg, #dc3545, #c82333);
        }

        .notificacion.warning {
            background: linear-gradient(135deg, #ffc107, #e0a800);
            color: #333;
        }

        .notificacion.info {
            background: linear-gradient(135deg, #17a2b8, #138496);
        }

        /* Responsive para móviles */
        @media (max-width: 768px) {
            .menu-header-actions {
                flex-direction: column;
                gap: 15px;
                padding: 15px;
            }

            .menu-title-section h1 {
                font-size: 1.8rem;
            }

            .menu-actions {
                width: 100%;
                justify-content: center;
            }

            .menu-action-btn {
                flex: 1;
                min-width: auto;
            }

            .compartir-opciones {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .notificacion {
                right: 10px;
                left: 10px;
                max-width: none;
                transform: translateY(-100px);
            }

            .notificacion.show {
                transform: translateY(0);
            }
        }

        @media (max-width: 480px) {
            .menu-header-actions {
                padding: 12px;
            }

            .menu-title-section h1 {
                font-size: 1.5rem;
            }

            .menu-actions {
                flex-direction: column;
                gap: 8px;
            }

            .menu-action-btn {
                width: 100%;
            }

            .menu-action-btn .btn-text {
                display: inline;
            }
        }

        /* Mejoras para el contenido del menú */
        .menu-carta {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
            border: 2px solid #f8f9fa;
        }

        @media (max-width: 768px) {
            .menu-carta {
                padding: 15px;
                border-radius: 10px;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>
                <img src="./cande logo.png" alt="Logo Heladería" class="header-logo"
                    onerror="this.style.display='none';">
                <!-- <span class="header-title">Heladería Artesanal</span> -->
            </h1>
            <div class="subtitle" id="rotating-subtitle">Sabores únicos, momentos inolvidables</div>
        </div>

        <nav class="nav-tabs">
            <ul>
                <li><a href="#" id="tab-productos" class="active">
                        <i class="bi bi-box-seam"></i> Productos
                    </a></li>
                <li><a href="#" id="tab-menu">
                        <i class="bi bi-file-image"></i> Menú/Carta
                    </a></li>
            </ul>
        </nav>

        <div class="content">
            <!-- Panel de filtros para productos -->
            <div class="filters-panel" id="filtros-productos">
                <div class="filters-header">
                    <div class="filters-title">
                        <i class="bi bi-funnel"></i>
                        Filtrar Productos
                    </div>
                </div>
                <div class="filters-content-productos">
                    <div class="search-section">
                        <input type="text" id="buscar-producto" class="search-input" placeholder="Buscar productos..."
                            oninput="filtrarProductos()">
                        <i class="bi bi-search search-icon"></i>
                    </div>

                    <div class="filter-actions">
                        <button class="btn btn-secondary" onclick="limpiarFiltros()" id="clear-producto-btn"
                            style="display:none">
                            <i class="bi bi-x-circle"></i> Limpiar
                        </button>
                    </div>
                </div>
                <div class="filter-dropdown">
                    <div class="categoria-buttons-grid" id="categoria-buttons"></div>

                </div>
            </div>

            <!-- Estadísticas de productos -->
            <div class="filter-stats" id="producto-stats">
                <div class="stats-info">
                    <div class="stat-item">
                        <i class="bi bi-box-seam"></i>
                        <span id="total-productos">0</span> productos
                    </div>
                    <div class="stat-item">
                        <i class="bi bi-eye"></i>
                        <span id="productos-mostrados">0</span> mostrados
                    </div>
                    <div class="stat-item" id="precio-promedio" style="display:none">
                        <i class="bi bi-currency-dollar"></i>
                        Precio promedio: $<span id="precio-promedio-valor">0</span>
                    </div>
                </div>
                <div class="active-filters" id="producto-active-filters"></div>
            </div>

            <div id="contenido-productos">
                <div class="loading">
                    <i class="bi bi-hourglass-split"></i>
                    Cargando productos...
                </div>
            </div>


            <!-- Vista Menú/Carta -->
            <div id="vista-menu" style="display:none; padding: 30px;"></div>
        </div>



    </div>

    <!-- Modal -->
    <div id="modal" class="modal" style="display:none" onclick="cerrarModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <i class="bi bi-info-circle"></i> Detalles del producto
                <button class="modal-close" onclick="cerrarModal()">&times;</button>
            </div>
            <div class="modal-body" id="modal-body">
            </div>
        </div>
    </div>









    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // Configuración de Supabase
        const supabaseUrl = "https://kntorhiruncbnhvvyint.supabase.co";
        const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtudG9yaGlydW5jYm5odnZ5aW50Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI4MTY1NjYsImV4cCI6MjA2ODM5MjU2Nn0.PpHPi0p0e_pdTloQip0X6-_NKG7KhHw89t4Yyrvm5ow";

        // Inicializar Supabase
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

        // Variables globales
        let productos = [];
        let categorias = [];
        let filtros = {
            texto: '',
            categoria: '',
            activos: []
        };

        // Frases rotativas para el subtítulo
        const frasesRotativas = [
            "Sabores únicos, momentos inolvidables",
            "Endulza tu día con nosotros",
            "La magia del helado artesanal",
            "Creamos sonrisas con cada cucharada",
            "Los mejores ingredientes, el mejor sabor",
            "Momentos dulces que perduran",
            "Artesanos del sabor auténtico",
            "Una cucharada de felicidad",
            "El frío más dulce del día",
            "Cada sabor, una historia que contar",
            "Te derretirás de placer",
            "Del helado al corazón",
            "Sabores que abrazan el alma",
            "Amor a primera bola",
            "Tu antojo, nuestro compromiso",
            "Lo artesanal se saborea mejor",
            "El postre que alegra tus días",
            "Helado hecho con cariño y sabor",
            "Porque te lo mereces… y lo sabes",
            "Alegría congelada para cualquier momento",
            "Dulces momentos que se derriten en tu boca"
        ];


        let fraseActual = 0;

        // Función para rotar frases
        function rotarFrases() {
            const subtitleElement = document.getElementById('rotating-subtitle');
            if (subtitleElement) {
                subtitleElement.style.opacity = '0';
                setTimeout(() => {
                    fraseActual = (fraseActual + 1) % frasesRotativas.length;
                    subtitleElement.textContent = frasesRotativas[fraseActual];
                    subtitleElement.style.opacity = '1';
                }, 500);
            }
        }

        // Iniciar rotación de frases
        setInterval(rotarFrases, 4000);

        // Emojis para categorías (sin mostrar en el select)
        const emojisCategorias = {
            'helados': '🍦',
            'helado': '🍦',
            'gelato': '🍨',
            'sorbete': '🧊',
            'paleta': '🍭',
            'sundae': '🍨',
            'Malteada': '🥤',
            'malteadas': '🥤',
            'batido': '🥤',
            'frappé': '🥤',
            'bebida': '🍹',
            'bebidas': '🥤',
            'Cafe': '☕',
            'cafe': '☕',
            'galleta': '🍪',
            'galletas': '🍪',
            'waffle': '🧇',
            'waffles': '🧇',
            'torta': '🎂',
            'postre': '🍰',
            'postres': '🍰',
            'dulce': '🍬',
            'salsa': '🍯',
            'topping': '🍒',
            'jarabe': '🍯',
            'cobertura': '🍫',
            'default': '🍦'
        };



        function obtenerEmojiCategoria(nombreCategoria) {
            if (!nombreCategoria) return generarTwemoji('🍦', 'emoji');

            const nombre = nombreCategoria.toLowerCase();

            // Buscar coincidencias más flexibles
            const emoji = Object.entries(emojisCategorias).find(([key]) =>
                nombre.includes(key) || key.includes(nombre)
            )?.[1] || emojisCategorias.default;

            return generarTwemoji(emoji, nombreCategoria);
        }

        function generarTwemoji(emoji, alt = '') {
            const codepoints = Array.from(emoji)
                .map(char => char.codePointAt(0).toString(16))
                .join('-');

            return `<img src="https://twemoji.maxcdn.com/v/latest/72x72/${codepoints}.png" class="icono-categoria" alt="${alt}" />`;
        }




        // Contar productos por categoría
        function contarProductosPorCategoria(categoriaId) {
            return productos.filter(p => p.categoria_id == categoriaId).length;
        }

        // Formatear precio en CUP
        function formatearPrecio(precio) {
            const precioNum = parseFloat(precio || 0);
            return new Intl.NumberFormat('es-CO', {
                style: 'currency',
                currency: 'COP',
                minimumFractionDigits: 0
            }).format(precioNum).replace('COP', '$');
        }


        // Cargar datos con mejor manejo de errores
        async function cargarDatos() {
            try {
                mostrarEstadoCarga();

                // Cargar productos con categorías
                const { data: productosData, error: productosError } = await supabase
                    .from('productos')
                    .select(`
                            *,
                            categoria:categorias(id, nombre, descripcion)
                        `)
                    .order('nombre');

                if (productosError) throw productosError;

                // Cargar categorías
                const { data: categoriasData, error: categoriasError } = await supabase
                    .from('categorias')
                    .select('*')
                    .order('nombre');

                if (categoriasError) throw categoriasError;

                productos = productosData || [];
                categorias = categoriasData || [];

                // Cargar categorías en el select de filtros
                cargarCategoriasBotones();


                // Mostrar productos
                mostrarProductos();
                actualizarEstadisticas();

            } catch (error) {
                console.error('Error al cargar datos:', error);
                mostrarError('Error al cargar los datos. Por favor, intenta de nuevo más tarde.');
            }
        }

        // Cargar categorías en el select con contador
        function cargarCategoriasBotones() {
            const contenedor = document.getElementById('categoria-buttons');
            if (!contenedor) return;

            contenedor.innerHTML = '';

            // Botón de "Todas"
            const btnTodas = document.createElement('div');
            btnTodas.className = 'categoria-btn';
            btnTodas.innerHTML = `<i class="bi bi-grid"></i><span>Todo</span>`;
            btnTodas.onclick = () => {
                filtros.categoria = '';
                mostrarProductos();
                actualizarFiltrosActivos();
                mostrarBotonLimpiar();
                marcarBotonActivo('');
            };
            contenedor.appendChild(btnTodas);

            categorias.forEach(categoria => {
                const emoji = obtenerEmojiCategoria(categoria.nombre);
                const btn = document.createElement('div');
                btn.className = 'categoria-btn';
                btn.innerHTML = `<span>${emoji}</span><span>${categoria.nombre}</span>`;
                btn.onclick = () => {
                    filtros.categoria = categoria.id;
                    mostrarProductos();
                    actualizarFiltrosActivos();
                    mostrarBotonLimpiar();
                    marcarBotonActivo(categoria.id);

                    // 👇 Scroll suave al área de productos
                    const seccionProductos = document.getElementById('contenido-productos');
                    if (seccionProductos) {
                        const posicion = seccionProductos.offsetTop - 100; // 100px más arriba del elemento
                        window.scrollTo({
                            top: posicion,
                            behavior: 'smooth'
                        });
                    }
                };
                contenedor.appendChild(btn);
            });

        }

        // Resaltar botón activo
        function marcarBotonActivo(categoriaId) {
            const botones = document.querySelectorAll('.categoria-btn');
            botones.forEach(btn => btn.classList.remove('active'));
            const index = categoriaId === '' ? 0 : categorias.findIndex(c => c.id == categoriaId) + 1;
            if (botones[index]) botones[index].classList.add('active');
        }



        // Mostrar estado de carga
        function mostrarEstadoCarga() {
            const contenidoProductos = document.getElementById('contenido-productos');
            if (contenidoProductos) {
                contenidoProductos.innerHTML = `
                        <div class="loading">
                            <i class="bi bi-hourglass-split"></i>
                            Cargando productos...
                        </div>
                    `;
            }
        }

        function mostrarProductos() {
            let productosFiltrados = [...productos];

            // Aplicar filtros
            if (filtros.categoria) {
                productosFiltrados = productosFiltrados.filter(p => p.categoria_id == filtros.categoria);
            }

            if (filtros.texto) {
                productosFiltrados = productosFiltrados.filter(p =>
                    p.nombre.toLowerCase().includes(filtros.texto.toLowerCase()) ||
                    (p.descripcion && p.descripcion.toLowerCase().includes(filtros.texto.toLowerCase()))
                );
            }

            const contenido = document.getElementById('contenido-productos');
            if (!contenido) return;

            if (productosFiltrados.length === 0) {
                contenido.innerHTML = `
                <div class="productos-grid">
                    <div class="no-results">
                        <i class="bi bi-search"></i>
                        <h3>No se encontraron productos</h3>
                        <p>Intenta ajustar los filtros o términos de búsqueda</p>
                    </div>
                </div>
            `;
                return;
            }

            // Agrupar productos por categoría
            const agrupados = {};
            productosFiltrados.forEach(p => {
                const catId = p.categoria_id;
                if (!agrupados[catId]) agrupados[catId] = [];
                agrupados[catId].push(p);
            });

            // Ordenar categorías por cantidad de productos (de mayor a menor)
            const categoriasOrdenadas = Object.entries(agrupados)
                .sort(([, aProductos], [, bProductos]) => bProductos.length - aProductos.length);

            let html = '';

            // Renderizar por grupo de categoría
            categoriasOrdenadas.forEach(([catId, productosDeCategoria]) => {
                const cat = categorias.find(c => c.id == catId) || { nombre: 'Sin categoría' };
                const emoji = obtenerEmojiCategoria(cat.nombre);

                html += `
                <h2 style="margin: 30px 10px 15px; font-size: 1.5rem; color: #c19653;">
                    ${emoji} ${cat.nombre} <span class="categoria-badge">${productosDeCategoria.length} productos</span>
                </h2>
                <div class="productos-grid">
            `;

                productosDeCategoria.forEach(producto => {
                    const descripcion = producto.descripcion || 'Delicioso producto de nuestra heladería';
                    const precioFormateado = formatearPrecio(producto.precio);
                    html += `
                    <div class="producto-card" onclick="mostrarDetalle(${producto.id})">
                    <div class="producto-card-imagen">
                            ${producto.imagen ?
                            `<img 
                                    src="${producto.imagen}" 
                                    alt="${producto.nombre}" 
                                    loading="lazy" 
                                    decoding="async"
                                    width="100%" height="200"
                                    style="object-fit: cover; display: block;"
                                    onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"
                                />

                                <div class="producto-card-placeholder" style="display:none">🍦</div>` :
                            `<div class="producto-card-placeholder">🍦</div>`
                        }
                        
                        </div>

                        <div class="producto-card-body">
                            <div class="producto-card-title">${producto.nombre}</div>
                            <div class="producto-card-descripcion">${descripcion}</div>
                            <div class="producto-card-footer">
                                <div class="producto-card-precio">${precioFormateado}</div>
                                <div class="producto-card-categoria">${cat.nombre}</div>
                            </div>
                        </div>
                    </div>
                `;
                });

                html += '</div>'; // cierre productos-grid
            });

            contenido.innerHTML = html;

            // Estadísticas
            const productosElement = document.getElementById('productos-mostrados');
            if (productosElement) {
                productosElement.textContent = productosFiltrados.length;
            }

            if (productosFiltrados.length > 0) {
                const precioPromedio = productosFiltrados.reduce((sum, p) => sum + parseFloat(p.precio || 0), 0) / productosFiltrados.length;
                const precioElement = document.getElementById('precio-promedio-valor');
                const precioContainer = document.getElementById('precio-promedio');
                if (precioElement && precioContainer) {
                    precioElement.textContent = precioPromedio.toLocaleString('es-ES', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                    precioContainer.style.display = 'flex';
                }
            } else {
                const precioContainer = document.getElementById('precio-promedio');
                if (precioContainer) {
                    precioContainer.style.display = 'none';
                }
            }
        }


        // Filtros
        function filtrarProductos() {
            const buscarProducto = document.getElementById('buscar-producto');
            const selectCategoria = document.getElementById('filtro-categoria-producto');

            if (buscarProducto) {
                filtros.texto = buscarProducto.value.trim();
            }
            if (selectCategoria) {
                filtros.categoria = selectCategoria.value;
            }

            mostrarProductos();
            actualizarEstadisticas();
            actualizarFiltrosActivos();
            mostrarBotonLimpiar();
        }

        function mostrarBotonLimpiar() {
            const btnLimpiar = document.getElementById('clear-producto-btn');
            if (!btnLimpiar) return;

            const tieneTexto = filtros.texto.length > 0;
            const tieneCategoria = filtros.categoria.length > 0;
            const mostrar = tieneTexto || tieneCategoria;

            btnLimpiar.style.display = mostrar ? 'inline-flex' : 'none';
        }

        function limpiarFiltros() {
            filtros.texto = '';
            filtros.categoria = '';

            const buscarProducto = document.getElementById('buscar-producto');
            const selectCategoria = document.getElementById('filtro-categoria-producto');

            if (buscarProducto) buscarProducto.value = '';
            if (selectCategoria) selectCategoria.value = '';

            mostrarProductos();
            actualizarEstadisticas();
            actualizarFiltrosActivos();
            mostrarBotonLimpiar();
        }

        // Actualizar estadísticas
        function actualizarEstadisticas() {
            const totalProductos = document.getElementById('total-productos');
            if (totalProductos) totalProductos.textContent = productos.length;
        }

        // Actualizar filtros activos
        function actualizarFiltrosActivos() {
            const productoFilters = document.getElementById('producto-active-filters');
            if (!productoFilters) return;

            productoFilters.innerHTML = '';

            if (filtros.texto) {
                productoFilters.innerHTML += `
                        <div class="filter-tag">
                            <i class="bi bi-search"></i> "${filtros.texto}"
                            <span class="remove" onclick="limpiarFiltroTexto()">&times;</span>
                        </div>
                    `;
            }

            if (filtros.categoria) {
                const categoria = categorias.find(c => c.id == filtros.categoria);
                if (categoria) {
                    productoFilters.innerHTML += `
                            <div class="filter-tag">
                                <i class="bi bi-tag"></i> ${categoria.nombre}
                                <span class="remove" onclick="limpiarFiltroCategoria()">&times;</span>
                            </div>
                        `;
                }
            }
        }

        // Limpiar filtros específicos
        function limpiarFiltroTexto() {
            filtros.texto = '';
            const buscarProducto = document.getElementById('buscar-producto');
            if (buscarProducto) buscarProducto.value = '';
            mostrarProductos();
            actualizarFiltrosActivos();
            mostrarBotonLimpiar();
        }

        function limpiarFiltroCategoria() {
            filtros.categoria = '';
            const selectCategoria = document.getElementById('filtro-categoria-producto');
            if (selectCategoria) selectCategoria.value = '';
            mostrarProductos();
            actualizarFiltrosActivos();
            mostrarBotonLimpiar();
        }

        // Modal
        // Función mejorada para mostrar detalles del producto en el modal
        // Función mejorada para mostrar detalles del producto en el modal
        function mostrarDetalle(id) {
            const producto = productos.find(p => p.id === id);
            if (!producto) return;

            const categoria = producto.categoria || { nombre: 'Sin categoría' };
            const precioFormateado = formatearPrecio(producto.precio);

            const modalBody = document.getElementById('modal-body');
            if (!modalBody) return;

            modalBody.innerHTML = `
        <div class="modal-producto-container">
            <!-- Sección de imagen -->
            <div class="modal-imagen-section">
                ${producto.imagen ?
                    `<img 
                        src="${producto.imagen}" 
                        alt="${producto.nombre}" 
                        class="modal-image"
                        loading="lazy"
                        decoding="async"
                        onclick="abrirImagenPantallaCompleta('${producto.imagen}', '${producto.nombre}')"
                        onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"
                    />
                    <div class="imagen-clickeable-overlay">
                        <i class="bi bi-arrows-fullscreen"></i>
                        Clic para ampliar
                    </div>
                    <div class="modal-placeholder" style="display:none;">🍦</div>` :
                    `<div class="modal-placeholder">🍦</div>`
                }
            </div>

            <!-- Sección de información -->
            <div class="modal-info-section">
                <h2 class="modal-producto-titulo">${producto.nombre}</h2>
                
                <div class="modal-info-grid">
                    <div class="modal-info-item">
                        <i class="bi bi-currency-dollar" style="color: #28a745; font-size: 1.2rem;"></i>
                        <div class="modal-info-label">Precio:</div>
                        <div class="modal-info-value">
                            <span class="modal-precio">${precioFormateado}</span>
                        </div>
                    </div>
                    
                    <div class="modal-info-item">
                        <i class="bi bi-tag" style="color: #6c757d; font-size: 1.2rem;"></i>
                        <div class="modal-info-label">Categoría:</div>
                        <div class="modal-info-value">
                            <span class="modal-categoria-badge">
                                ${obtenerEmojiCategoria(categoria.nombre)} ${categoria.nombre}
                            </span>
                        </div>
                    </div>
                </div>

                ${producto.descripcion ? `
                    <div class="modal-descripcion">
                        <div class="modal-descripcion-titulo">
                            <i class="bi bi-info-circle" style="color: #6c757d;"></i>
                            Descripción
                        </div>
                        <div class="modal-descripcion-texto">${producto.descripcion}</div>
                    </div>
                ` : ''}
            </div>

            <!-- Sección de acciones -->
            <div class="modal-actions">
                <button class="btn btn-primary" onclick="cerrarModal()">
                    <i class="bi bi-check-circle"></i> Entendido
                </button>
            </div>
        </div>
    `;

            const modal = document.getElementById('modal');
            if (modal) {
                modal.style.display = 'flex';

                // Prevenir scroll del body cuando el modal está abierto
                document.body.style.overflow = 'hidden';
            }
        }

        // NUEVA función para abrir imagen en pantalla completa
        function abrirImagenPantallaCompleta(imagenUrl, nombreProducto) {
            // Crear el modal de pantalla completa
            const fullscreenModal = document.createElement('div');
            fullscreenModal.className = 'fullscreen-image-modal';
            fullscreenModal.onclick = cerrarImagenPantallaCompleta;

            fullscreenModal.innerHTML = `
        <div class="fullscreen-image-container" onclick="event.stopPropagation()">
            <img src="${imagenUrl}" alt="${nombreProducto}" class="fullscreen-image">
            <button class="fullscreen-close" onclick="cerrarImagenPantallaCompleta()" title="Cerrar (ESC)">
                <i class="bi bi-x"></i>
            </button>
            <div class="fullscreen-info">
                <i class="bi bi-info-circle"></i>
                ${nombreProducto} • Clic fuera de la imagen o presiona ESC para cerrar
            </div>
        </div>
    `;

            // Agregar al body
            document.body.appendChild(fullscreenModal);

            // Prevenir scroll del body
            document.body.style.overflow = 'hidden';

            // Event listener para cerrar con ESC
            document.addEventListener('keydown', cerrarConEscape);
        }

        // Función para cerrar imagen de pantalla completa
        function cerrarImagenPantallaCompleta() {
            const fullscreenModal = document.querySelector('.fullscreen-image-modal');
            if (fullscreenModal) {
                fullscreenModal.remove();

                // Restaurar scroll del body solo si no hay otros modales abiertos
                const modalPrincipal = document.getElementById('modal');
                if (!modalPrincipal || modalPrincipal.style.display === 'none') {
                    document.body.style.overflow = '';
                }

                // Remover event listener de ESC
                document.removeEventListener('keydown', cerrarConEscape);
            }
        }

        // Función para cerrar con tecla ESC
        function cerrarConEscape(event) {
            if (event.key === 'Escape') {
                cerrarImagenPantallaCompleta();
            }
        }

        // Función mejorada para cerrar el modal principal
        function cerrarModal(event) {
            const modal = document.getElementById('modal');
            if (!modal) return;

            if (!event || event.target === modal || event.target.closest('.modal-close') || event.target.closest('.btn')) {
                modal.style.display = 'none';

                // Restaurar scroll del body solo si no hay imagen en pantalla completa
                const fullscreenModal = document.querySelector('.fullscreen-image-modal');
                if (!fullscreenModal) {
                    document.body.style.overflow = '';
                }
            }
        }




        function mostrarError(mensaje) {
            const contenido = document.getElementById('contenido-productos');
            if (!contenido) return;

            contenido.innerHTML = `
                    <div class="error">
                        <i class="bi bi-exclamation-triangle" style="font-size: 2rem; margin-bottom: 10px; display: block;"></i>
                        <strong>¡Oops! Algo salió mal</strong><br>
                        ${mensaje}
                    </div>
                `;
        }

        // Event listeners
        document.addEventListener('keydown', function (event) {
            if (event.key === 'Escape') {
                cerrarModal();
            }
        });

        // Búsqueda en tiempo real con debounce
        let searchTimeout;
        function debounceSearch(callback, delay = 300) {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(callback, delay);
        }

        // Agregar event listeners después de que el DOM esté cargado
        function agregarEventListeners() {
            const buscarProducto = document.getElementById('buscar-producto');

            if (buscarProducto) {
                buscarProducto.addEventListener('input', function () {
                    debounceSearch(filtrarProductos);
                });
            }
        }



        function mostrarMenuCarta() {
            const vistaMenu = document.getElementById('vista-menu');
            if (!vistaMenu) return;

            if (productos.length === 0) {
                vistaMenu.innerHTML = `
            <div class="no-results">
                <i class="bi bi-journal-x"></i>
                <h3>Menú vacío</h3>
                <p>No hay productos cargados en este momento.</p>
            </div>
        `;
                return;
            }

            // Agrupar productos por categoría
            const agrupados = {};
            productos.forEach(p => {
                const catId = p.categoria_id;
                if (!agrupados[catId]) agrupados[catId] = [];
                agrupados[catId].push(p);
            });

            // Ordenar categorías por cantidad
            const categoriasOrdenadas = Object.entries(agrupados)
                .sort(([, a], [, b]) => b.length - a.length);

            // Header con botones de acción
            let html = `
        <div class="menu-header-actions">
            <div class="menu-title-section">
                <h1 style="color: #c19653; font-size: 2.2rem; margin: 0; display: flex; align-items: center; gap: 10px;">
                    <i class="bi bi-journal-text"></i>
                    Nuestro Menú
                </h1>
                <p style="color: #6c757d; margin: 5px 0 0 0; font-size: 1rem;">
                    Descubre todos nuestros deliciosos productos
                </p>
            </div>
            
            <div class="menu-actions">
                <button class="btn btn-primary menu-action-btn" onclick="descargarMenuPDF()" title="Descargar menú en PDF">
                    <i class="bi bi-download"></i>
                    <span class="btn-text">Descargar PDF</span>
                </button>
                
                <button class="btn btn-outline menu-action-btn" onclick="mostrarOpcionesCompartir()" title="Compartir menú">
                    <i class="bi bi-share"></i>
                    <span class="btn-text">Compartir</span>
                </button>
            </div>
        </div>
        
        <div class="menu-carta" id="menu-carta-contenido">
    `;

            categoriasOrdenadas.forEach(([catId, productosDeCategoria]) => {
                const categoria = categorias.find(c => c.id == catId) || { nombre: 'Sin categoría' };
                const emoji = obtenerEmojiCategoria(categoria.nombre);

                html += `
            <div class="menu-categoria">
                <h2 style="color: #c19653; font-size: 1.8rem; border-bottom: 2px solid #f0e0c0; padding-bottom: 10px; margin-top: 30px;">
                    ${emoji} ${categoria.nombre}
                </h2>
                <ul style="list-style: none; padding: 0;">
        `;

                productosDeCategoria.forEach(p => {
                    const precio = formatearPrecio(p.precio);
                    html += `
                <li style="padding: 12px 0; border-bottom: 1px dashed #ddd;">
                    <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                        <div>
                            <strong style="font-size: 2.0rem; color: #333;">${p.nombre}</strong><br>
                            <span style="font-size: 1.2rem; color: #777;">${p.descripcion || ''}</span>
                        </div>
                        <div style="font-weight: bold; color: #28a745; font-size: 1.1rem;">${precio}</div>
                    </div>
                </li>
            `;
                });

                html += '</ul></div>';
            });

            html += '</div>';
            vistaMenu.innerHTML = html;

            document.getElementById('filtros-productos').style.display = 'none';
        }

        // Función para descargar el menú como PDF
        function descargarMenuPDF() {
            // Mostrar loading
            const btnDescargar = document.querySelector('.menu-action-btn');
            const textoOriginal = btnDescargar.innerHTML;
            btnDescargar.innerHTML = '<i class="bi bi-hourglass-split"></i> <span class="btn-text">Generando...</span>';
            btnDescargar.disabled = true;

            // Simular generación (aquí conectarías con tu backend)
            setTimeout(() => {
                // Crear elemento de descarga temporal
                const link = document.createElement('a');
                link.href = './menu-heladeria.pdf'; // Ruta a tu PDF en el directorio del proyecto
                link.download = 'menu-heladeria-artesanal.pdf';
                link.target = '_blank';

                // Verificar si el archivo existe antes de intentar descargarlo
                fetch(link.href, { method: 'HEAD' })
                    .then(response => {
                        if (response.ok) {
                            // El archivo existe, proceder con la descarga
                            document.body.appendChild(link);
                            link.click();
                            document.body.removeChild(link);

                            // Mostrar mensaje de éxito
                            mostrarNotificacion('¡PDF descargado exitosamente!', 'success');
                        } else {
                            // El archivo no existe
                            mostrarNotificacion('PDF no disponible en este momento. Intenta más tarde.', 'warning');
                        }
                    })
                    .catch(error => {
                        console.error('Error al verificar PDF:', error);
                        mostrarNotificacion('Error al descargar el PDF. Revisa tu conexión.', 'error');
                    })
                    .finally(() => {
                        // Restaurar botón
                        btnDescargar.innerHTML = textoOriginal;
                        btnDescargar.disabled = false;
                    });
            }, 1000);
        }

        // Función para mostrar opciones de compartir
        function mostrarOpcionesCompartir() {
            const url = window.location.href;
            const titulo = 'Menú - Heladería Artesanal';
            const descripcion = 'Descubre nuestros deliciosos helados artesanales y productos únicos';

            // Crear modal de opciones de compartir
            const compartirModal = document.createElement('div');
            compartirModal.className = 'modal';
            compartirModal.style.display = 'flex';

            compartirModal.innerHTML = `
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <i class="bi bi-share"></i> Compartir Menú
                <button class="modal-close" onclick="cerrarModalCompartir()">&times;</button>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 20px;">
                    <p style="color: #6c757d; margin-bottom: 15px;">
                        Comparte nuestro menú con tus amigos y familiares:
                    </p>
                </div>
                
                <div class="compartir-opciones">
                    <button class="compartir-btn whatsapp" onclick="compartirWhatsApp('${url}', '${titulo}')">
                        <i class="bi bi-whatsapp"></i>
                        WhatsApp
                    </button>
                    
                    <button class="compartir-btn facebook" onclick="compartirFacebook('${url}')">
                        <i class="bi bi-facebook"></i>
                        Facebook
                    </button>
                    
                    <button class="compartir-btn twitter" onclick="compartirTwitter('${url}', '${titulo}')">
                        <i class="bi bi-twitter"></i>
                        Twitter
                    </button>
                    
                    <button class="compartir-btn email" onclick="compartirEmail('${url}', '${titulo}', '${descripcion}')">
                        <i class="bi bi-envelope"></i>
                        Email
                    </button>
                </div>
                
                <div style="margin-top: 20px; padding-top: 20px; border-top: 2px solid #f8f9fa;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #6c757d;">
                        O copia el enlace:
                    </label>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="url-para-copiar" value="${url}" readonly 
                               style="flex: 1; padding: 10px; border: 2px solid #e9ecef; border-radius: 8px; background: #f8f9fa;">
                        <button class="btn btn-primary" onclick="copiarURL()">
                            <i class="bi bi-clipboard"></i> Copiar
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `;

            document.body.appendChild(compartirModal);
            document.body.style.overflow = 'hidden';
        }

        // Funciones de compartir en redes sociales
        function compartirWhatsApp(url, titulo) {
            const mensaje = encodeURIComponent(`${titulo} - ${url}`);
            window.open(`https://wa.me/?text=${mensaje}`, '_blank');
        }

        function compartirFacebook(url) {
            window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`, '_blank');
        }

        function compartirTwitter(url, titulo) {
            const texto = encodeURIComponent(titulo);
            window.open(`https://twitter.com/intent/tweet?text=${texto}&url=${encodeURIComponent(url)}`, '_blank');
        }

        function compartirEmail(url, titulo, descripcion) {
            const asunto = encodeURIComponent(titulo);
            const cuerpo = encodeURIComponent(`${descripcion}\n\nVisita nuestro menú: ${url}`);
            window.location.href = `mailto:?subject=${asunto}&body=${cuerpo}`;
        }

        // Función para copiar URL al portapapeles
        function copiarURL() {
            const input = document.getElementById('url-para-copiar');
            input.select();
            input.setSelectionRange(0, 99999); // Para móviles

            try {
                document.execCommand('copy');
                mostrarNotificacion('¡Enlace copiado al portapapeles!', 'success');
            } catch (err) {
                console.error('Error al copiar:', err);
                mostrarNotificacion('No se pudo copiar el enlace', 'error');
            }
        }

        // Función para cerrar modal de compartir
        function cerrarModalCompartir() {
            const modal = document.querySelector('.modal:last-child');
            if (modal) {
                modal.remove();
                document.body.style.overflow = '';
            }
        }

        // Función para mostrar notificaciones
        function mostrarNotificacion(mensaje, tipo = 'info') {
            const notificacion = document.createElement('div');
            notificacion.className = `notificacion ${tipo}`;

            const iconos = {
                'success': 'bi-check-circle',
                'error': 'bi-x-circle',
                'warning': 'bi-exclamation-triangle',
                'info': 'bi-info-circle'
            };

            notificacion.innerHTML = `
        <i class="bi ${iconos[tipo]}"></i>
        ${mensaje}
    `;

            document.body.appendChild(notificacion);

            // Animar entrada
            setTimeout(() => notificacion.classList.add('show'), 100);

            // Remover después de 3 segundos
            setTimeout(() => {
                notificacion.classList.remove('show');
                setTimeout(() => notificacion.remove(), 300);
            }, 3000);
        }














        // Inicializar aplicación
        window.addEventListener('load', function () {
            console.log('🚀 Iniciando Heladería Artesanal...');
            agregarEventListeners();
            cargarDatos();



            document.getElementById('tab-productos').addEventListener('click', (e) => {
                e.preventDefault();
                document.getElementById('contenido-productos').style.display = 'block';
                document.getElementById('vista-menu').style.display = 'none';

                document.getElementById('tab-productos').classList.add('active');
                document.getElementById('tab-menu').classList.remove('active');
                document.getElementById('filtros-productos').style.display = 'block';
            });

            document.getElementById('tab-menu').addEventListener('click', (e) => {
                e.preventDefault();
                document.getElementById('contenido-productos').style.display = 'none';
                document.getElementById('vista-menu').style.display = 'block';

                document.getElementById('tab-menu').classList.add('active');
                document.getElementById('tab-productos').classList.remove('active');

                mostrarMenuCarta(); // Mostrar carta
            });

            // Recargar datos cada 60 segundos
            // setInterval(cargarDatos, 60000);


            let paginaCargada = true; // Ya estamos dentro del load

            // Prevenir salida accidental
            window.addEventListener('beforeunload', function (e) {
                if (paginaCargada) {
                    const mensaje = '¿Estás seguro de que quieres salir? Se perderán los filtros aplicados.';
                    e.preventDefault();
                    e.returnValue = mensaje;
                    return mensaje;
                }
            });

            // Prevenir navegación hacia atrás
            let navegacionPrevenida = false;

            window.addEventListener('popstate', function (e) {
                if (paginaCargada && !navegacionPrevenida) {
                    const confirmar = confirm('¿Estás seguro de que quieres salir de la página?');

                    if (!confirmar) {
                        history.pushState(null, null, location.href);
                        navegacionPrevenida = true;
                        setTimeout(() => { navegacionPrevenida = false; }, 100);
                    } else {
                        paginaCargada = false;
                        history.back();
                        location.reload(); // Recargar la página al salir
                    }
                }
            });

            // Crear estado inicial
            history.pushState(null, null, location.href);
            paginaCargada = true; // Marcamos que la página ya se ha cargado
            navegacionPrevenida = false; // Reiniciar navegación prevenida

        });
    </script>



</body>

</html>
